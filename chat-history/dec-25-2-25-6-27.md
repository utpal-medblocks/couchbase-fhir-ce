Summary of actions attempted on 2025-12-25

- Added SMART/US-Core scopes to `scripts/keycloak/realm.json` to include clientScopes from the frontend.
- Appended idempotent client-scope creation logic to `scripts/keycloak/seed_keycloak.sh`.
- Implemented `TokenResponseEnhancer.java` to decode `access_token` JWT and inject top-level `patient` / `fhirUser` into token JSON responses.
- Implemented `KeycloakTokenProxyController.java` to proxy token POSTs to Keycloak and apply the enhancer to responses.
- Modified `SmartConfigurationController.java` to optionally advertise a `KEYCLOAK_TOKEN_PROXY_URL` as the token endpoint in SMART discovery.
- Attempted to refactor `SmartTokenEnhancerFilter.java` to reuse `TokenResponseEnhancer` (replace manual JWT parsing), but an intermediate malformed patch corrupted the file.
- Restored corrupted files (`SmartConfigurationController.java`, `SmartTokenEnhancerFilter.java`) from `git HEAD` and re-applied safer edits.
- Iteratively patched `SmartTokenEnhancerFilter.java` to call `TokenResponseEnhancer` inside `doFilter` (preserving error mapping and fallback behavior).
- Ran `mvn -f backend/pom.xml -DskipTests=true compile` to validate the changes; compilation surfaced syntax issues caused by earlier malformed edits which were subsequently fixed.
- Current artifacts created/modified: `TokenResponseEnhancer.java`, `KeycloakTokenProxyController.java`, updated `realm.json`, updated `seed_keycloak.sh`, updated `SmartConfigurationController.java`, updated `SmartTokenEnhancerFilter.java` (restored and integrated).

End of summary.
